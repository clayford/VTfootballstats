{
    "contents" : "# c4k donor analysis\n\n# at home\nsetwd(\"~/_statistics/C4K\")\n\n# at work\nsetwd(\"~/personal\")\n\ndonors <- read.csv(\"C4K_export.csv\",header=TRUE, stringsAsFactors = FALSE)\n\n# make personID, donor type factors\ndonors$X_kf_PersonID <- as.factor(donors$X_kf_PersonID)\ndonors$DonorType <- as.factor(donors$DonorType)\ndonors$X_kp_DonationID <- as.factor(donors$X_kp_DonationID)\n\n# convert \nfor (i in 1:44) {\n\tdonors[[i]] <- as.factor(donors[[i]])\n\t}\n\n# convert date string to date class\ndonors$Date <- as.Date(donors$Date, format=\"%m/%d/%Y\")\n\n# create var for year of donation\ndonors$DonationYear <- as.POSIXlt(donors$Date)$year + 1900\n\n# z_Amount_Summary is total amount donated per PersonID\n\n# convert amount to num\ndonors$Amount <- as.numeric(donors$Amount) # introduces 3 NAs\n\n# which records have NA for Amount\nmiss_amount <- donors[which(is.na(donors$Amount)),]\nwrite.csv(miss_amount,\"c4k_missing_amount.csv\") # give to Kala\n# drop records with Amount = NA\ndonors <- donors[which(!is.na(donors$Amount)),]\n\n\n# about donor type\nlevels(donors$DonorType) # 5 levels, one missing\nlength(which(donors$DonorType == \"\")) # 104\n\nsummary(donors$Amount) # reveals negative donations\n#drop amounts of 0 and below\ndonors <- donors[which(donors$Amount > 0),]\n\n\n# average donatation amount by donor type\naggregate(Amount ~ DonorType, data=donors, mean)\naggregate(Amount ~ DonorType, data=donors, median)\naggregate(Amount ~ DonorType, data=donors, min) \naggregate(Amount ~ DonorType, data=donors, max)\naggregate(Amount ~ DonorType, data=donors, sum)\n\n\n# amounts donated by anonymous donor type\ndonors$Amount[which(donors$DonorType==\"Anonymous\")]\n\n# create 2nd dataset with one record per donor (by PersonID)\ndonors <- donors[order(donors$X_kf_PersonID),] # sort by X_kf_PersonID\none <- duplicated(donors$X_kf_PersonID) # logical: TRUE = duplicate\ndonors2 <- donors[!one,] # want FALSE because they're not dupes\n\n# break down of donor type\ntable(donors2$DonorType)\nsummary(table(donors2$X_kf_PersonID))\n\n\n# cumulative giving by donor type\naggregate(z_Amount_Summary ~ DonorType, data=donors2, mean)\naggregate(z_Amount_Summary ~ DonorType, data=donors2, median)\naggregate(z_Amount_Summary ~ DonorType, data=donors2, min)\naggregate(z_Amount_Summary ~ DonorType, data=donors2, max)\naggregate(z_Amount_Summary ~ DonorType, data=donors2, sum)\n\n\n# average donation amount by year\naggregate(Amount ~ DonationYear, data=donors, mean)\naggregate(Amount ~ DonationYear, data=donors, median)\n\n\n\n# total donation amount by year\naggregate(Amount ~ DonationYear, data=donors, sum)\n\n# line plot of total donations by year\nplot(aggregate(Amount ~ DonationYear, data=donors, sum, \n\tsubset = (DonationYear!=\"2013\" & DonorType==\"Business\")), type=\"l\", col=1, ylim=c(0,160000),xlim=c(2000,2012),\n\tmain=\"Total Donations by Donor Type by Year through 2012\")\nlines(aggregate(Amount ~ DonationYear, data=donors, sum, subset = (DonationYear!=\"2013\" & DonorType==\"Personal\")), type=\"l\", col=2)\nlines(aggregate(Amount ~ DonationYear, data=donors, sum, subset = (DonationYear!=\"2013\" & DonorType==\"Foundation\")), type=\"l\", col=3)\nlines(aggregate(Amount ~ DonationYear, data=donors, sum, subset = (DonationYear!=\"2013\" & DonorType==\"Anonymous\")), type=\"l\", col=4)\nlines(aggregate(Amount ~ DonationYear, data=donors, sum, subset = (DonationYear!=\"2013\" & DonorType==\"\")), type=\"l\", col=5)\nlegend(\"topleft\", c(\"Business\", \"Personal\", \"Foundation\", \"Anonymous\", \"Missing\"), lty=1, col=1:5)\n\n\n\naggregate(Amount ~ DonationYear + DonorType, data=donors, sum)\n\n# sorting data frame by 2 vars\ndonors2[order(donors2$DonorType, donors2$z_Amount_Summary),]\n\n# ideas: top donors by money, top donors by number of donations, avg time between donations\n# average number of donations\n\n# counts of donations per personID\ncdon <- sort(table(donors$X_kf_PersonID), decreasing=TRUE)\nsort(cdon, decreasing=TRUE) # people with most donations\ncdon[1:10] # top 10\ncdon <- cdon[-1006] # drop last value which equals 0\nsummary(cdon) # provides min, max, median, mean, quartiles\nh_cdon <- hist(cdon) # creates bins and provides counts in bins\nbarplot(cdon[1:10]) # barplot of top 10 donors\n\n# bin counts of donations\nbreaks <- c(0,1,2,3,4,5,10,15,20,50,100)\ncountdonors <- cut(cdon,breaks)\nsummary(countdonors)\n\nagchart <- aggregate(Amount ~ DonorType + DonationYear, data=donors, sum)\nlibrary(reshape2) # see R graphics cookbook p. 369\nagwide <- dcast(agchart, DonorType ~ DonationYear, value.var=\"Amount\")\n\n# proportional stacked bar graph\nlibrary(plyr)\nlibrary(ggplot2)\n# scale data to 100% in each stack; R graphics cookbook p. 37\nagbp <- ddply(agchart, \"DonationYear\", transform, Percent = Amount / sum(Amount)*100)\n# make DonationYear factor\nagbp[,2] <- as.factor(agbp[,2])\nagbp <- agbp[which(agbp$DonationYear!=\"2013\"),] # drop 2013\nlevels(agbp$DonorType)[1] <- \"Missing\" #Add \"Missing\"\n\n# create bar graph\nggplot(agbp, aes(x=DonationYear,y=Percent, fill=DonorType)) + \n         geom_bar(stat=\"identity\", color=\"black\") +\n         guides(fill=guide_legend(reverse=TRUE)) +\n         scale_fill_brewer(palette=\"Pastel1\") +\n         ggtitle(\"Proportion of Donations by Donor Type by Year\")\n\n\ndim(donors)\n",
    "created" : 1371773803651.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1245088302",
    "id" : "259A4E32",
    "lastKnownWriteTime" : 1371914655,
    "path" : "~/_statistics/C4K/C4K_donor_analysis.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}
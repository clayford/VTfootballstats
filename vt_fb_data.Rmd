
<!-- Automatically generated by RStudio [12861c30b10411e1afa60800200c9a66] -->
### vt_fb_data.R
clayford --- *May 25, 2013, 4:55 PM*`r opts_chunk$set(tidy=FALSE, comment=NA, fig.path='figure-compile-notebook-12861c30b/')`
```{r}
# drive summaries would be good to start with
# get last three columns: How Lost, Pl-Yds, TOP
library(XML) # needed to convert HTML table to list object

vtFballData <- function(start,stop,season){
	dsf <- c()
	# read the source code
	for (i in start:stop){
	url <- paste("http://www.hokiesports.com/football/stats/showstats.html?",i,sep="")
	web_page <- readLines(url)

	# find where VT drive summary begins
	dsum <- web_page[(grep("Virginia Tech Drive Summary", web_page) - 2):(grep("Virginia Tech Drive Summary", web_page) + 18)]
	dsum2 <- readHTMLTable(dsum)
	rn <- dim(dsum2[[1]])[1]
	cn <- dim(dsum2[[1]])[2]
	ds <- dsum2[[1]][4:rn,c(1,(cn-2):cn)]
	ds[,3] <- as.character(ds[,3]) # convert from factor to character
	py <- do.call(rbind,strsplit(sub("-"," ",ds[,3])," "))
	ds2 <- cbind(ds,py)
	ds2[,5] <- as.character(ds2[,5]) # convert from factor to character
	ds2[,6] <- as.character(ds2[,6]) # convert from factor to character
	ds2[,5] <- as.numeric(ds2[,5]) # convert from character to numeric
	ds2[,6] <- as.numeric(ds2[,6]) # convert from character to numeric
	ds2[,3] <- NULL # drop original pl-yds column

	names(ds2) <-c("quarter","result","top","plays","yards")
	# drop unused factor levels carried over from readlines
	ds2$quarter <- ds2$quarter[, drop=TRUE] 
	ds2$result <- ds2$result[, drop=TRUE]

	# convert TOP from factor to character
	ds2[,3] <- as.character(ds2[,3]) 
	# convert TOP from M:S to just seconds
	ds2$top <- sapply(strsplit(ds2$top,":"),
  		function(x) {
    		x <- as.numeric(x)
    		x[1]*60 + x[2]})

	# need to add opponent
	opp <- web_page[grep("Drive Summary", web_page)]
	opp <- opp[grep("Virginia Tech", opp, invert=TRUE)] # get the one that is not VT
	opp <- strsplit(opp,">")[[1]][2]
	opp <- sub(" Drive Summary</td","",opp)
	ds2 <- cbind(season,opp,ds2)
	dsf <- rbind(dsf,ds2)
	}
return(dsf)
}

dsData2012 <- vtFballData(14871,14882,2012)


url <- paste("http://www.hokiesports.com/football/stats/showstats.html?14871")
web_page <- readLines(url)


##some stats##
sapply(ds2[1,],class) # check class of each variable

TOP
avgTOP <- round(mean(dsData2012$top[dsData2012$top > 0])) # drop TOP = 0, take mean, round
paste(avgTOP%/%60,":",avgTOP%%60,sep="") # convert to minutes and seconds (rough)
tapply(dsData2012$top,dsData2012$opp,mean) # avg TOP per game
tapply(dsData2012$top,dsData2012$opp,sum) # total TOP per game
tapply(dsData2012$top,dsData2012$opp,function(x){paste(sum(x)%/%60,":",sum(x)%%60,sep="")}) # total TOP per game, converted to m:s


####################################################################################
# find where play-by-play begins
grep("Play-By-Play", web_page)
[1] 1144

# get just the play-by-play section
# table code starts two lines above "Play-By-Play"
# don't need anything from Participation on down

test <- web_page[(grep("Play-By-Play", web_page) - 2):(grep("<h4>Participation</h4>", web_page)-1)]
test2 <- readHTMLTable(test)

```
